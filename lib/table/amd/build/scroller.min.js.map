{"version":3,"file":"scroller.min.js","sources":["../src/scroller.js"],"sourcesContent":["// This file is part of Moodle - http://moodle.org/\n//\n// Moodle is free software: you can redistribute it and/or modify\n// it under the terms of the GNU General Public License as published by\n// the Free Software Foundation, either version 3 of the License, or\n// (at your option) any later version.\n//\n// Moodle is distributed in the hope that it will be useful,\n// but WITHOUT ANY WARRANTY; without even the implied warranty of\n// MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the\n// GNU General Public License for more details.\n//\n// You should have received a copy of the GNU General Public License\n// along with Moodle.  If not, see <http://www.gnu.org/licenses/>.\n\n/**\n * Module to handle dynamic table features.\n *\n * @module     core_table/scroller\n * @copyright  2023 The Open University of Israel\n * @license    http://www.gnu.org/copyleft/gpl.html GNU GPL v3 or later\n */\nlet loaded = false;\nlet scrolling = false; // Used to prevent event loops.\n\nexport const init = () => {\n    if (loaded) {\n        return; // Already loaded.\n    }\n    loaded = true;\n\n    // Listen to the table width changes.\n    const tableObserver = new ResizeObserver((entries) => {\n        document.getElementById(entries[0].target.dataset.scroller).style.width =\n            parseInt(entries[0].contentRect.width) + 'px';\n    });\n\n    let scrollers = document.querySelectorAll('.flexible_table_topscroller_container');\n\n    scrollers.forEach(scroller => {\n        let table = scroller.nextSibling.querySelector(':scope > table.flexible');\n        if (table) {\n            scroller.children[0].style.height = '1px'; // Set a height to show the scrollbar.\n            if (!table.dataset.scroller) {\n                table.dataset.scroller = scroller.children[0].id; // Make sure the table is linked to the scroller.\n            }\n            let tableContainer = table.parentNode;\n            scroller.querySelector('.flexible_table_topscroller').style.width = window.getComputedStyle(table).width;\n            tableContainer.addEventListener('scroll', (e) => {\n                if (scrolling) {\n                    scrolling = false;\n                } else {\n                    scrolling = true;\n                    scroller.scrollLeft = e.target.scrollLeft;\n                }\n            });\n            scroller.addEventListener('scroll', (e) => {\n                if (scrolling) {\n                    scrolling = false;\n                } else {\n                    scrolling = true;\n                    tableContainer.scrollLeft = e.target.scrollLeft;\n                }\n            });\n            tableObserver.observe(table);\n        }\n    });\n};\n"],"names":["loaded","scrolling","tableObserver","ResizeObserver","entries","document","getElementById","target","dataset","scroller","style","width","parseInt","contentRect","querySelectorAll","forEach","table","nextSibling","querySelector","children","height","id","tableContainer","parentNode","window","getComputedStyle","addEventListener","e","scrollLeft","observe"],"mappings":";;;;;;;;IAsBIA,QAAS,EACTC,WAAY,gBAEI,QACZD,cAGJA,QAAS,QAGHE,cAAgB,IAAIC,gBAAgBC,UACtCC,SAASC,eAAeF,QAAQ,GAAGG,OAAOC,QAAQC,UAAUC,MAAMC,MAC9DC,SAASR,QAAQ,GAAGS,YAAYF,OAAS,QAGjCN,SAASS,iBAAiB,yCAEhCC,SAAQN,eACVO,MAAQP,SAASQ,YAAYC,cAAc,8BAC3CF,MAAO,CACPP,SAASU,SAAS,GAAGT,MAAMU,OAAS,MAC/BJ,MAAMR,QAAQC,WACfO,MAAMR,QAAQC,SAAWA,SAASU,SAAS,GAAGE,QAE9CC,eAAiBN,MAAMO,WAC3Bd,SAASS,cAAc,+BAA+BR,MAAMC,MAAQa,OAAOC,iBAAiBT,OAAOL,MACnGW,eAAeI,iBAAiB,UAAWC,IACnC1B,UACAA,WAAY,GAEZA,WAAY,EACZQ,SAASmB,WAAaD,EAAEpB,OAAOqB,eAGvCnB,SAASiB,iBAAiB,UAAWC,IAC7B1B,UACAA,WAAY,GAEZA,WAAY,EACZqB,eAAeM,WAAaD,EAAEpB,OAAOqB,eAG7C1B,cAAc2B,QAAQb"}